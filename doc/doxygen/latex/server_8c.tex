\hypertarget{server_8c}{
\section{server.c File Reference}
\label{server_8c}\index{server.c@{server.c}}
}


This file implements the storage server.  


{\ttfamily \#include $<$stdio.h$>$}\par
{\ttfamily \#include $<$stdlib.h$>$}\par
{\ttfamily \#include $<$unistd.h$>$}\par
{\ttfamily \#include $<$sys/types.h$>$}\par
{\ttfamily \#include $<$sys/socket.h$>$}\par
{\ttfamily \#include $<$arpa/inet.h$>$}\par
{\ttfamily \#include $<$netdb.h$>$}\par
{\ttfamily \#include $<$string.h$>$}\par
{\ttfamily \#include $<$assert.h$>$}\par
{\ttfamily \#include $<$signal.h$>$}\par
{\ttfamily \#include $<$time.h$>$}\par
{\ttfamily \#include \char`\"{}utils.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}database.h\char`\"{}}\par
\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\hypertarget{server_8c_a36b090ddf192f97d9fecf8ff5a98996e}{
\#define \hyperlink{server_8c_a36b090ddf192f97d9fecf8ff5a98996e}{MAX\_\-LISTENQUEUELEN}~20}
\label{server_8c_a36b090ddf192f97d9fecf8ff5a98996e}

\begin{DoxyCompactList}\small\item\em The maximum number of queued connections. \item\end{DoxyCompactList}\item 
\hypertarget{server_8c_a7873f105e3c2f933f7cd10bdc277f33e}{
\#define {\bfseries LOGGING}~1}
\label{server_8c_a7873f105e3c2f933f7cd10bdc277f33e}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{server_8c_aeb40787d297c7fdd7fca322b9729aadc}{server\_\-set} (char $\ast$table, char $\ast$key, char $\ast$value)
\begin{DoxyCompactList}\small\item\em Insert or update a table, key, value pair to the database. \item\end{DoxyCompactList}\item 
void \hyperlink{server_8c_a9ff56d8772e4b79379c81ec321bcb10f}{process\_\-census} (char $\ast$line)
\begin{DoxyCompactList}\small\item\em Process a command from the client. \item\end{DoxyCompactList}\item 
int \hyperlink{server_8c_a94a11842e987c681b4f881460900b7d3}{handle\_\-command} (int sock, char $\ast$cmd)
\begin{DoxyCompactList}\small\item\em Process a command from the client. \item\end{DoxyCompactList}\item 
int \hyperlink{server_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em Start the storage server. \item\end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{server_8c_a9cc2d8f3bfea63827f66715fa34b5124}{
FILE $\ast$ {\bfseries sfp}}
\label{server_8c_a9cc2d8f3bfea63827f66715fa34b5124}

\item 
\hypertarget{server_8c_a0df479ae945ee930deb719f1d4451b84}{
struct \hyperlink{structconfig__params}{config\_\-params} {\bfseries params}}
\label{server_8c_a0df479ae945ee930deb719f1d4451b84}

\item 
\hypertarget{server_8c_a84244ff547d08db274c8627beac50c4e}{
double {\bfseries totprotime} = 0}
\label{server_8c_a84244ff547d08db274c8627beac50c4e}

\item 
\hypertarget{server_8c_a2dea0f577488754525b2f11f8910acd2}{
struct \hyperlink{structdatabase}{database} $\ast$ {\bfseries db}}
\label{server_8c_a2dea0f577488754525b2f11f8910acd2}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
This file implements the storage server. The storage server should be named \char`\"{}server\char`\"{} and should take a single command line argument that refers to the configuration file.

The storage server should be able to communicate with the client library functions declared in \hyperlink{storage_8h}{storage.h} and implemented in \hyperlink{storage_8c}{storage.c}. 

Definition in file \hyperlink{server_8c_source}{server.c}.



\subsection{Function Documentation}
\hypertarget{server_8c_a94a11842e987c681b4f881460900b7d3}{
\index{server.c@{server.c}!handle\_\-command@{handle\_\-command}}
\index{handle\_\-command@{handle\_\-command}!server.c@{server.c}}
\subsubsection[{handle\_\-command}]{\setlength{\rightskip}{0pt plus 5cm}int handle\_\-command (
\begin{DoxyParamCaption}
\item[{int}]{ sock, }
\item[{char $\ast$}]{ cmd}
\end{DoxyParamCaption}
)}}
\label{server_8c_a94a11842e987c681b4f881460900b7d3}


Process a command from the client. 


\begin{DoxyParams}{Parameters}
\item[{\em sock}]The socket connected to the client. \item[{\em cmd}]The command received from the client. \end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns 0 on success, -\/1 otherwise. 
\end{DoxyReturn}


Definition at line 75 of file server.c.



References LOG, logger(), config\_\-params::password, sendall(), and config\_\-params::username.



Referenced by main().

\hypertarget{server_8c_a0ddf1224851353fc92bfbff6f499fa97}{
\index{server.c@{server.c}!main@{main}}
\index{main@{main}!server.c@{server.c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{ argc, }
\item[{char $\ast$}]{ argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}
\label{server_8c_a0ddf1224851353fc92bfbff6f499fa97}


Start the storage server. 

This is the main entry point for the storage server. It reads the configuration file, starts listening on a port, and proccesses commands from clients. 

Definition at line 228 of file server.c.



References handle\_\-command(), LOG, logger(), MAX\_\-CMD\_\-LEN, MAX\_\-LISTENQUEUELEN, process\_\-census(), read\_\-config(), recvline(), config\_\-params::server\_\-host, and config\_\-params::server\_\-port.

\hypertarget{server_8c_a9ff56d8772e4b79379c81ec321bcb10f}{
\index{server.c@{server.c}!process\_\-census@{process\_\-census}}
\index{process\_\-census@{process\_\-census}!server.c@{server.c}}
\subsubsection[{process\_\-census}]{\setlength{\rightskip}{0pt plus 5cm}void process\_\-census (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{ line}
\end{DoxyParamCaption}
)}}
\label{server_8c_a9ff56d8772e4b79379c81ec321bcb10f}


Process a command from the client. 


\begin{DoxyParams}{Parameters}
\item[{\em sock}]The socket connected to the client. \item[{\em cmd}]The command received from the client. \end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns 0 on success, -\/1 otherwise. 
\end{DoxyReturn}


Definition at line 57 of file server.c.



References server\_\-set().



Referenced by main().

\hypertarget{server_8c_aeb40787d297c7fdd7fca322b9729aadc}{
\index{server.c@{server.c}!server\_\-set@{server\_\-set}}
\index{server\_\-set@{server\_\-set}!server.c@{server.c}}
\subsubsection[{server\_\-set}]{\setlength{\rightskip}{0pt plus 5cm}int server\_\-set (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{ table, }
\item[{char $\ast$}]{ key, }
\item[{char $\ast$}]{ value}
\end{DoxyParamCaption}
)}}
\label{server_8c_aeb40787d297c7fdd7fca322b9729aadc}


Insert or update a table, key, value pair to the database. 


\begin{DoxyParams}{Parameters}
\item[{\em table}]: the table to insert or update \item[{\em key}]: the key to insert or update \item[{\em value}]: the value to insert or update \end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns 0 on success, -\/1 on table not found, -\/2 on key not found 
\end{DoxyReturn}


Definition at line 46 of file server.c.



Referenced by process\_\-census().

